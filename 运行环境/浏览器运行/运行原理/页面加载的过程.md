## `从浏览器输入地址到呈现页面中间发生了什么事（通信过程）`
简单来说：
- 浏览器进行url地址解析
- 将解析出的域名进行DNS解析，域名解析为ip
- 通过ip寻址和arp,找到目标服务器
- 进行tcp三次握手，建立tcp连接
- 浏览器发送数据，等待服务器响应
- 服务器处理请求，并做出相应
- 浏览器接收服务器响应，获取数据
- 渲染页面

详细说明：
     
0. 浏览器进行地址解析
  
  当在浏览器中输入地址，按下回车后，浏览器获取到的是一个字符串。对这个地址url进行解析， 获取到协议，主机，端口，路径，参数等等信息

1. 查找缓存，检查请求头设置的强缓存是否过期，如果没有过期则使用缓存，如果过期，则进行下一步

2. 将解析出的域名进行dns解析

  在1中已经获取到了服务器域名，需要将域名转换为对应的ip地址。dns解析如下：

  - 浏览器DNS缓存
    
    先查看浏览器dns缓存中是否已存储有该域名对应的ip
  - 系统DNS缓存
  
    再查看操作系统dns缓存中是否有对应的ip(例如hosts文件)
  - 本区域的DNS服务器
    
    再发送DNS请求到本区域的DNS服务器，查看是否存在对应ip，本地DNS服务器在接收到请求之后，会先查找递归查找自己的缓存记录，有缓存则直接返回，否则向根DNS服务器发送请求

  - 根DNS服务器
  
    根DNS服务器在接收到本地DNS服务器请求之后，并不会直接返回域名和IP地址之间的对应关系，而是告诉本地DNS服务器可以到域服务器上面去查找，并给出域服务器的地址，这个过程是迭代的。

  - 本地DNS服务器向域服务器发送请求
    
    本地DNS服务器在接收到根DNS服务器的响应之后，会向对应的域服务器发送请求，例如当前例子中的域服务器是 .com域服务器。

    域服务器接收到请求后，也不会直接返回域名和IP地址之间的对应关系，而是告诉本地DNS服务器，你请求的域名的解析服务器的地址。
  - 本地DNS服务器向解析服务器发送请求
  
    本地DNS服务器向解析服务器发送请求，获取到了一个域名和IP地址的对应关系，本地DNS服务器把这个对应关系返回给浏览器，并缓存在自己本地。
  
  DNS在进行区域传输时使用TCP协议，其他时候使用UDP协议

3. 通过ip寻址和arp,找到目标服务器
   
   通过2中获取到的ip, 找到对应的服务器，arp: 地址转化协议-将ip地址转化为mac地址，与dns相似先查缓存，再查路由器

4. 进行三次握手，建立tcp连接
   
   在3中我们找到了目标ip,并获得了服务器ip的mac地址，此时浏览器就会请求和服务器连接，用来传输数据。

   tcp是稳定双向面向连接的，断开时也会两边都断开。

   TCP连接：
   - 通过三次握手建立客户端和服务器端的连接
   - 进行数据传输

    这里有一个重要的机制，就是接收方接收到数据包后必须要向发送方确认，如果发送方没有接收到这个确认的消息，就会判定当前数据包丢失，并重新发送该数据包。当然，发送的过程中还有一个优化的策略，就是把 大的数据包拆成一个个小的数据包，一次传输到接收方，接收方按照这个小包的顺序把它们组装成完整的数据包；
   - 断开连接， 通过4次挥手断开TCP连接

5. 浏览器发送请求，等待服务器响应

    浏览器对发送请求信息，请求报文格式：

    - 起始行：请求方法，请求的URL, 请求协议
    - 头部信息： 浏览器信息user-agent, content-type, cookie等

    - 请求体： get请求没有主体，请求信息放在请求头部。如果是post请求，有主题信息

6. 服务器处理请求，并对请求做出响应
    
    服务器从固定端口接收到 TCP 报文开始，它会对 TCP 连接进行处理，对 HTTP 协议进行解析，并按照报文格式进一步封装成 HTTP Request 对象供上层使用。

    一般并发量大的网站，都会把同一个应用部署在多个服务中，客户端第一时间请求到的是反向代理服务器，再由代理服务器请求应用服务器。

    响应报文格式：
    - 响应行
    - 响应头
    - 响应体
  
7. 浏览器收到服务器响应，得到数据
8. 渲染页面
   
   获取到服务器响应后，浏览器会根据相应的content-type字段对响应字符串进行解析。

   能够解析并成功解析就显示，能够解析但解析错误就报错，不能解析就下载

   如果请求的是html，浏览器会采用自上向下的方式解析，先解析html，直到遇到外部样式和外部脚本。

   外部样式和外部脚本（在没有async, defer时），会同步加载，但是外部样式会阻塞外部脚本的执行，dom解析完成，js脚本执行成功后dom树构建完成，之后加载dom中引用的图片，即：

   1. html解析 -> 外部样式,脚本加载 -> 外部样式执行 -> 外部脚本执行 -> html继续解析 -> DOM树构建完成 -> 加载图片 -> 页面加载完成
   2. 如果是动态生成的脚本，不受样式影响，在解析到它时会执行
   3. 外部样式后续外部脚本含有async(defer)属性时，外部样式不会阻塞该脚本的加载与执行

